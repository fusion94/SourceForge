<?php
//
// SourceForge: Breaking Down the Barriers to Open Source Development
// Copyright 1999-2000 (c) The SourceForge Crew
// http://sourceforge.net
//

function display_groups_option($sname,$selectid,$group_id) {

	//PROBLEM - use common libraries for SELECT boxes

	$query = "select doc_group, groupname "
		."from doc_groups "
		."where group_id = $group_id "
		."order by groupname";
	$result = db_query($query);

	//what is this doing exactly??
	if ((strstr($selectid,"i")) or (strstr($selectid," "))) { //"i" for irrelevant
		//order irrelevant : 
		util_build_select_box($result,$sname,$selectid);	
	} else {
		util_build_select_box($result,$sname,$selectid);
	}

/*
	print "<select name=\"$sname\" size=1>\n";
	if ((strstr($selectid,"i")) or (strstr($selectid," "))) { //"i" for irrelevant
		while ($row = db_fetch_array($result)) {
	 		print "<option value=\"$row['doc_group']\">$row['groupname']</option> \n";
		} // end row iteration

	} else {
		while ($row = db_fetch_array($result)) {
			if ($row['doc_group'] == $selectid) {
	 			print "<option value=\"$row['doc_group']\" selected>$row[groupname]</option> \n";
			} else {
	 			print "<option value=\"$row['doc_group']\">$row['groupname']</option> \n";
			}

		} // end row iteration

	} //end else
	print "</select>\n";
*/
} //end display_groups_option


function display_groups($group_id) {
	// show list of groups to edit.
	$query = "select * "
		."from doc_groups "
		."where group_id = '$group_id'";
	$result = db_query($query);
	
	if (db_numrows($result) < 1) {
		print "No groups currently exist.";
	} else {
		echo '
			<table border="1">
			 <tr>
			 <td>Group ID</td>
			 <td>Group Name</td>
		  	 <td>Controls</td>
			</tr>
		';

		while ($row = db_fetch_array($result)) {
			$output = "<tr>".
				"<td>".$row['doc_group']."</td>\n".
				"<td>".$row['groupname']."</td>\n".
				"<td>[ <a href=\"index.php?mode=groupdelete&doc_group=".$row['doc_group']."&group_id=".$group_id."\">Delete</A> ] [ <a href=\"index.php?mode=groupedit&doc_group=".$row['doc_group']."&group_id=".$group_id."\">Change Name</a> ]\n</td>".
				"</tr>\n";

			print "$output";

		}
		echo '</table>';
	}
		
	docman_footer($params);

}

function display_docs($style,$group_id) {
	global $sys_datefmt;

	$query = "select * "
		."from doc_data as d1, doc_groups as d2 "
		."where d1.stateid = '".$style."' "
		."and d2.group_id = '".$group_id."' " 
		."and d1.doc_group = d2.doc_group"; 
	$result = db_query($query);

	$query = "select name"
		."from doc_states "
		."where stateid = ".$style."";
	$result2 = db_query($query);
	
	$row = db_fetch_array($result);
		
	if (db_numrows($result) < 1) {
		echo 'No '.$row['name'].' docs available <p>';
	} else {
		echo '
			<table border=1>
			 <tr>
				<td>Document ID</td>
				<td>Name</td>
				<td>Create Date</td>
 			 </tr>


		';

		while ($row = db_fetch_array($result)) {
			print 	"<tr>"
				."<td>".$row['docid']."</td>"
				."<td><a href=\"index.php?docid=".$row['docid']."&mode=docedit&group_id=".$group_id."\">".$row['title']."</a></td>" 

				."<td>.".date($sys_datefmt,$row['createdate'])."</td>"
				."</tr>";
		}	

		echo '</table>';
	}//end else

} //end function display_docs($style)

function docman_header($title,$pagehead) {

	global $group_id;

	site_header(array('title'=>$title));
	print "<h2>$pagehead</h2>";
	if (user_ismember($group_id,"D1")) {

		print "<a href=\"/docman/admin/index.php?group_id=".$group_id."\">Admin</a><br><hr>";

	} else { 
		print "<br><hr>";
	}

}

function docman_footer($params) {
        global $feedback;
        html_feedback_bottom($feedback);
        site_footer($params);

}


?>
